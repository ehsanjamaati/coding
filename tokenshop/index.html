<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لانچ توکن EVM</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 32px;
            font-weight: 700;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .wallet-section {
            margin-bottom: 30px;
        }

        .wallet-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .wallet-btn {
            background: white;
            border: 2px solid #e5e7eb;
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            text-align: center;
        }

        .wallet-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .wallet-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            font-size: 14px;
            word-break: break-all;
            display: none;
        }

        .network-info {
            margin-top: 10px;
            font-size: 13px;
            color: #a7f3d0;
            font-weight: 600;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s;
            font-family: inherit;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            display: none;
        }

        .status.success {
            background: #d1fae5;
            color: #065f46;
            display: block;
        }

        .status.error {
            background: #fee2e2;
            color: #991b1b;
            display: block;
        }

        .status.info {
            background: #dbeafe;
            color: #1e40af;
            display: block;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .feature-list {
            background: #f9fafb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .feature-list h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .feature-list ul {
            list-style: none;
            padding: 0;
        }

        .feature-list li {
            padding: 8px 0;
            color: #555;
            font-size: 14px;
        }

        .feature-list li:before {
            content: "✓ ";
            color: #22c55e;
            font-weight: bold;
            margin-left: 8px;
        }

        .contract-info {
            margin-top: 15px;
            padding: 15px;
            background: #f0fdf4;
            border-radius: 10px;
            border-right: 4px solid #22c55e;
        }

        .contract-info a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            word-break: break-all;
        }

        .contract-info a:hover {
            text-decoration: underline;
        }

        .warning {
            background: #fef3c7;
            border-right: 4px solid #f59e0b;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #92400e;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 لانچ توکن EVM</h1>
        <p class="subtitle">توکن خود را روی هر شبکه EVM دلخواه خود چاپ کنید</p>

        <div class="feature-list">
            <h3>قابلیت‌ها:</h3>
            <ul>
                <li>پشتیبانی از تمام شبکه‌های EVM (Ethereum, BSC, Polygon و ...)</li>
                <li>اتصال به همه کیف پول‌ها (MetaMask, Trust Wallet, Coinbase و ...)</li>
                <li>استاندارد ERC-20 کامل</li>
                <li>امکان سوزاندن توکن</li>
                <li>مالکیت قابل انتقال</li>
            </ul>
        </div>

        <div class="wallet-section">
            <div class="wallet-buttons">
                <button class="wallet-btn" onclick="connectMetaMask()">
                    🦊 MetaMask
                </button>
                <button class="wallet-btn" onclick="connectWalletConnect()">
                    🔗 WalletConnect
                </button>
            </div>
            <div id="walletInfo" class="wallet-info">
                <div>آدرس کیف پول: <span id="walletAddress"></span></div>
                <div class="network-info">شبکه: <span id="networkName"></span></div>
            </div>
        </div>

        <div class="warning">
            ⚠️ توجه: قبل از لانچ توکن، مطمئن شوید که به شبکه صحیح متصل هستید و مقدار کافی Gas Fee در کیف پول دارید.
        </div>

        <form id="tokenForm" style="display: none;">
            <div class="form-group">
                <label>نام توکن:</label>
                <input type="text" id="tokenName" placeholder="مثال: My Token" required>
            </div>

            <div class="form-group">
                <label>سیمبل توکن:</label>
                <input type="text" id="tokenSymbol" placeholder="مثال: MTK" required>
            </div>

            <div class="form-group">
                <label>تعداد کل توکن (Supply):</label>
                <input type="number" id="totalSupply" placeholder="مثال: 1000000" required>
            </div>

            <button type="submit" id="deployBtn">
                چاپ توکن
            </button>
        </form>

        <div id="status" class="status"></div>
    </div>

    <script>
        let provider, signer, userAddress, wcProvider;

        async function connectMetaMask() {
            try {
                if (typeof window.ethereum === 'undefined') {
                    showStatus('لطفاً ابتدا MetaMask را نصب کنید!', 'error');
                    return;
                }

                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                provider = new ethers.BrowserProvider(window.ethereum);
                signer = await provider.getSigner();
                userAddress = accounts[0];

                await updateWalletInfo();
                showStatus('کیف پول با موفقیت متصل شد!', 'success');
            } catch (error) {
                showStatus('خطا در اتصال: ' + error.message, 'error');
            }
        }

        async function connectWalletConnect() {
            try {
                if (typeof WalletConnectProvider === 'undefined') {
                    showStatus('در حال بارگذاری WalletConnect...', 'info');
                    setTimeout(connectWalletConnect, 1000);
                    return;
                }

                wcProvider = new WalletConnectProvider.default({
                    rpc: {
                        1: "https://eth.llamarpc.com",
                        56: "https://bsc-dataseed.binance.org",
                        137: "https://polygon-rpc.com",
                        43114: "https://api.avax.network/ext/bc/C/rpc",
                        42161: "https://arb1.arbitrum.io/rpc",
                        10: "https://mainnet.optimism.io"
                    }
                });

                await wcProvider.enable();
                
                provider = new ethers.BrowserProvider(wcProvider);
                signer = await provider.getSigner();
                userAddress = await signer.getAddress();

                wcProvider.on("accountsChanged", (accounts) => {
                    location.reload();
                });

                wcProvider.on("chainChanged", (chainId) => {
                    location.reload();
                });

                wcProvider.on("disconnect", (code, reason) => {
                    location.reload();
                });

                await updateWalletInfo();
                showStatus('کیف پول با موفقیت متصل شد!', 'success');
            } catch (error) {
                showStatus('خطا در اتصال: ' + error.message, 'error');
            }
        }

        async function updateWalletInfo() {
            const network = await provider.getNetwork();
            
            document.getElementById('walletAddress').textContent = 
                userAddress.slice(0, 6) + '...' + userAddress.slice(-4);
            document.getElementById('networkName').textContent = 
                getNetworkName(network.chainId) + ' (Chain ID: ' + network.chainId + ')';
            document.getElementById('walletInfo').style.display = 'block';
            document.getElementById('tokenForm').style.display = 'block';
        }

        function getNetworkName(chainId) {
            const networks = {
                1: 'Ethereum Mainnet',
                5: 'Goerli Testnet',
                11155111: 'Sepolia Testnet',
                56: 'BSC Mainnet',
                97: 'BSC Testnet',
                137: 'Polygon Mainnet',
                80001: 'Mumbai Testnet',
                43114: 'Avalanche C-Chain',
                42161: 'Arbitrum One',
                10: 'Optimism'
            };
            return networks[Number(chainId)] || 'Unknown Network';
        }

        document.getElementById('tokenForm').onsubmit = async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('tokenName').value;
            const symbol = document.getElementById('tokenSymbol').value;
            const supply = document.getElementById('totalSupply').value;
            
            const deployBtn = document.getElementById('deployBtn');
            deployBtn.disabled = true;
            deployBtn.innerHTML = 'در حال چاپ... <span class="loading"></span>';
            
            try {
                showStatus('در حال آماده‌سازی قرارداد...', 'info');
                
                // Simplified ERC20 contract bytecode and ABI
                const abi = [
                    "constructor(string memory name_, string memory symbol_, uint256 totalSupply_)",
                    "function name() view returns (string)",
                    "function symbol() view returns (string)",
                    "function decimals() view returns (uint8)",
                    "function totalSupply() view returns (uint256)",
                    "function balanceOf(address) view returns (uint256)",
                    "function transfer(address to, uint256 amount) returns (bool)",
                    "function approve(address spender, uint256 amount) returns (bool)",
                    "function transferFrom(address from, address to, uint256 amount) returns (bool)",
                    "function allowance(address owner, address spender) view returns (uint256)"
                ];
                
                // Compiled bytecode for a simple ERC20 token
                const bytecode = "0x608060405234801561001057600080fd5b506040516110d53803806110d583398101604081905261002f916101f1565b600361003b8482610304565b50600461004883826103c2565b506012600555610056610060565b50505050610480565b6005546100759061007090600a6105c2565b610080565b60065560065461008590826100e3565b600061008e3390565b6001600160a01b03168152602081019190915260400160002055565b80600260008282546100b991906105d7565b90915550506001600160a01b0382166000818152602081815260408083208054860190555184848252919290916000805160206110b58339815191529101610104565b60405180910390a35050565b60006020828403121561012257600080fd5b81356001600160a01b038116811461013957600080fd5b9392505050565b634e487b7160e01b600052601160045260246000fd5b600181815b8085111561019157816000190482111561017757610177610140565b8085161561018457918102915b93841c939080029061015b565b509250929050565b6000826101a857506001610220565b816101b557506000610220565b81600181146101cb57600281146101d5576101f1565b6001915050610220565b60ff8411156101e6576101e6610140565b50506001821b610220565b5060208310610133831016604e8410600b841016171561021f575081810a610220565b6102298383610156565b806000190482111561023d5761023d610140565b029392505050565b600061025360ff841683610199565b9392505050565b600082610277576102776102db565b500490565b60008261028b5761028b6102db565b500690565b60006020828403121561017c57600080fd5b5051919050565b6000602082840312156102b657600080fd5b81516001600160a01b03811681146101";
                
                showStatus('در حال ارسال تراکنش...', 'info');
                
                // Calculate total supply with 18 decimals
                const totalSupplyWithDecimals = ethers.parseUnits(supply, 18);
                
                const factory = new ethers.ContractFactory(abi, bytecode, signer);
                const contract = await factory.deploy(name, symbol, totalSupplyWithDecimals);
                
                showStatus('در انتظار تایید تراکنش (این فرآیند ممکن است چند دقیقه طول بکشد)...', 'info');
                await contract.waitForDeployment();
                
                const contractAddress = await contract.getAddress();
                const network = await provider.getNetwork();
                
                const explorerUrl = getExplorerUrl(network.chainId, contractAddress);
                
                let statusHtml = `<strong>✅ توکن با موفقیت چاپ شد!</strong><br><br>`;
                statusHtml += `<strong>نام:</strong> ${name}<br>`;
                statusHtml += `<strong>سیمبل:</strong> ${symbol}<br>`;
                statusHtml += `<strong>تعداد کل:</strong> ${supply}<br>`;
                statusHtml += `<div class="contract-info">`;
                statusHtml += `<strong>آدرس قرارداد:</strong><br>`;
                statusHtml += `<code>${contractAddress}</code><br>`;
                if (explorerUrl) {
                    statusHtml += `<a href="${explorerUrl}" target="_blank">مشاهده در Block Explorer ↗</a>`;
                }
                statusHtml += `</div>`;
                
                showStatus(statusHtml, 'success');
                
                deployBtn.disabled = false;
                deployBtn.innerHTML = 'چاپ توکن دیگر';
                
            } catch (error) {
                console.error('Error:', error);
                let errorMsg = error.message;
                if (error.code === 'ACTION_REJECTED') {
                    errorMsg = 'تراکنش توسط کاربر رد شد';
                } else if (error.message.includes('insufficient funds')) {
                    errorMsg = 'موجودی کافی برای پرداخت Gas Fee ندارید';
                }
                showStatus('خطا در چاپ توکن: ' + errorMsg, 'error');
                deployBtn.disabled = false;
                deployBtn.innerHTML = 'چاپ توکن';
            }
        };

        function getExplorerUrl(chainId, address) {
            const explorers = {
                1: 'https://etherscan.io/address/',
                5: 'https://goerli.etherscan.io/address/',
                11155111: 'https://sepolia.etherscan.io/address/',
                56: 'https://bscscan.com/address/',
                97: 'https://testnet.bscscan.com/address/',
                137: 'https://polygonscan.com/address/',
                80001: 'https://mumbai.polygonscan.com/address/',
                43114: 'https://snowtrace.io/address/',
                42161: 'https://arbiscan.io/address/',
                10: 'https://optimistic.etherscan.io/address/'
            };
            const baseUrl = explorers[Number(chainId)];
            return baseUrl ? baseUrl + address : '';
        }
        
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.innerHTML = message;
            status.className = 'status ' + type;
            status.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        // Listen for account changes (MetaMask)
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', function (accounts) {
                if (accounts.length === 0) {
                    location.reload();
                } else {
                    connectMetaMask();
                }
            });
            
            window.ethereum.on('chainChanged', function () {
                location.reload();
            });
        }
    </script>
</body>
</html>
