<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لانچ توکن EVM</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 32px;
            font-weight: 700;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .wallet-section {
            margin-bottom: 30px;
        }

        .connect-wallet-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .connect-wallet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .wallet-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            font-size: 14px;
            word-break: break-all;
            display: none;
        }

        .network-info {
            margin-top: 10px;
            font-size: 13px;
            color: #a7f3d0;
            font-weight: 600;
        }

        .disconnect-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            margin-top: 10px;
            cursor: pointer;
            font-size: 13px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s;
            font-family: inherit;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            display: none;
        }

        .status.success {
            background: #d1fae5;
            color: #065f46;
            display: block;
        }

        .status.error {
            background: #fee2e2;
            color: #991b1b;
            display: block;
        }

        .status.info {
            background: #dbeafe;
            color: #1e40af;
            display: block;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .feature-list {
            background: #f9fafb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .feature-list h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .feature-list ul {
            list-style: none;
            padding: 0;
        }

        .feature-list li {
            padding: 8px 0;
            color: #555;
            font-size: 14px;
        }

        .feature-list li:before {
            content: "✓ ";
            color: #22c55e;
            font-weight: bold;
            margin-left: 8px;
        }

        .contract-info {
            margin-top: 15px;
            padding: 15px;
            background: #f0fdf4;
            border-radius: 10px;
            border-right: 4px solid #22c55e;
        }

        .contract-info a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            word-break: break-all;
        }

        .contract-info a:hover {
            text-decoration: underline;
        }

        .warning {
            background: #fef3c7;
            border-right: 4px solid #f59e0b;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #92400e;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 450px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #333;
            font-size: 20px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 28px;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: auto;
            line-height: 1;
        }

        .close-modal:hover {
            color: #333;
            transform: none;
        }

        .wallet-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .wallet-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .wallet-option:hover {
            border-color: #667eea;
            background: #f9fafb;
            transform: translateY(-2px);
        }

        .wallet-icon {
            width: 48px;
            height: 48px;
            font-size: 48px;
        }

        .wallet-name {
            font-weight: 600;
            color: #333;
            font-size: 14px;
            text-align: center;
        }

        .qr-section {
            text-align: center;
            padding: 20px;
            border: 2px dashed #e5e7eb;
            border-radius: 12px;
            margin-top: 20px;
        }

        .qr-section h4 {
            color: #666;
            margin-bottom: 15px;
            font-size: 14px;
        }

        #qrcode {
            display: inline-block;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 لانچ توکن EVM</h1>
        <p class="subtitle">توکن خود را روی هر شبکه EVM دلخواه خود چاپ کنید</p>

        <div class="feature-list">
            <h3>قابلیت‌ها:</h3>
            <ul>
                <li>پشتیبانی از تمام شبکه‌های EVM (Ethereum, BSC, Polygon و ...)</li>
                <li>اتصال به +170 کیف پول مختلف</li>
                <li>استاندارد ERC-20 کامل</li>
                <li>سورس کد قابل verify در Block Explorer</li>
                <li>مالکیت کامل توکن با شما</li>
            </ul>
        </div>

        <div class="wallet-section">
            <button id="connectBtn" class="connect-wallet-btn" onclick="openWalletModal()">
                🔗 اتصال کیف پول
            </button>
            <div id="walletInfo" class="wallet-info">
                <div>آدرس کیف پول: <span id="walletAddress"></span></div>
                <div class="network-info">شبکه: <span id="networkName"></span></div>
                <button class="disconnect-btn" onclick="disconnectWallet()">قطع اتصال</button>
            </div>
        </div>

        <div class="warning">
            ⚠️ توجه: قبل از لانچ توکن، مطمئن شوید که به شبکه صحیح متصل هستید و مقدار کافی Gas Fee در کیف پول دارید.
        </div>

        <form id="tokenForm" style="display: none;">
            <div class="form-group">
                <label>نام توکن:</label>
                <input type="text" id="tokenName" placeholder="مثال: My Token" required>
            </div>

            <div class="form-group">
                <label>سیمبل توکن:</label>
                <input type="text" id="tokenSymbol" placeholder="مثال: MTK" maxlength="10" required>
            </div>

            <div class="form-group">
                <label>تعداد کل توکن (Supply):</label>
                <input type="number" id="totalSupply" placeholder="مثال: 1000000" required>
            </div>

            <button type="submit" id="deployBtn">
                چاپ توکن
            </button>
        </form>

        <div id="status" class="status"></div>
    </div>

    <!-- Wallet Modal -->
    <div id="walletModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>انتخاب کیف پول</h3>
                <button class="close-modal" onclick="closeWalletModal()">×</button>
            </div>
            
            <div class="wallet-grid">
                <div class="wallet-option" onclick="connectMetaMask()">
                    <div class="wallet-icon">🦊</div>
                    <div class="wallet-name">MetaMask</div>
                </div>
                
                <div class="wallet-option" onclick="connectCoinbase()">
                    <div class="wallet-icon">🔵</div>
                    <div class="wallet-name">Coinbase Wallet</div>
                </div>
                
                <div class="wallet-option" onclick="connectTrust()">
                    <div class="wallet-icon">💙</div>
                    <div class="wallet-name">Trust Wallet</div>
                </div>
                
                <div class="wallet-option" onclick="connectWalletConnect()">
                    <div class="wallet-icon">📱</div>
                    <div class="wallet-name">WalletConnect</div>
                </div>
            </div>

            <div id="qrSection" class="qr-section" style="display: none;">
                <h4>اسکن با موبایل</h4>
                <div id="qrcode"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    
    <script>
        let provider, signer, userAddress, wcProvider;

        function openWalletModal() {
            document.getElementById('walletModal').classList.add('active');
        }

        function closeWalletModal() {
            document.getElementById('walletModal').classList.remove('active');
            document.getElementById('qrSection').style.display = 'none';
        }

        async function connectMetaMask() {
            try {
                if (typeof window.ethereum === 'undefined') {
                    showStatus('لطفاً ابتدا MetaMask را نصب کنید! می‌توانید از metamask.io دانلود کنید.', 'error');
                    return;
                }

                closeWalletModal();
                showStatus('در حال اتصال به MetaMask...', 'info');

                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                provider = new ethers.BrowserProvider(window.ethereum);
                signer = await provider.getSigner();
                userAddress = accounts[0];

                await updateWalletInfo();
                showStatus('کیف پول با موفقیت متصل شد!', 'success');

                // Listen for changes
                window.ethereum.on('accountsChanged', handleAccountsChanged);
                window.ethereum.on('chainChanged', () => location.reload());

            } catch (error) {
                showStatus('خطا در اتصال: ' + error.message, 'error');
            }
        }

        async function connectCoinbase() {
            if (typeof window.coinbaseWalletExtension !== 'undefined') {
                await connectWithProvider(window.coinbaseWalletExtension, 'Coinbase Wallet');
            } else {
                showStatus('Coinbase Wallet نصب نیست. لطفاً از coinbase.com/wallet دانلود کنید.', 'error');
            }
        }

        async function connectTrust() {
            if (typeof window.trustwallet !== 'undefined') {
                await connectWithProvider(window.trustwallet, 'Trust Wallet');
            } else {
                // For mobile, use WalletConnect
                showStatus('برای اتصال Trust Wallet، از گزینه WalletConnect استفاده کنید.', 'info');
            }
        }

        async function connectWithProvider(ethereumProvider, walletName) {
            try {
                closeWalletModal();
                showStatus(`در حال اتصال به ${walletName}...`, 'info');

                const accounts = await ethereumProvider.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                provider = new ethers.BrowserProvider(ethereumProvider);
                signer = await provider.getSigner();
                userAddress = accounts[0];

                await updateWalletInfo();
                showStatus('کیف پول با موفقیت متصل شد!', 'success');
            } catch (error) {
                showStatus('خطا در اتصال: ' + error.message, 'error');
            }
        }

        async function connectWalletConnect() {
            try {
                showStatus('در حال بارگذاری WalletConnect...', 'info');

                wcProvider = new WalletConnectProvider.default({
                    rpc: {
                        1: "https://eth.llamarpc.com",
                        5: "https://goerli.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161",
                        11155111: "https://sepolia.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161",
                        56: "https://bsc-dataseed.binance.org",
                        97: "https://data-seed-prebsc-1-s1.binance.org:8545",
                        137: "https://polygon-rpc.com",
                        80001: "https://rpc-mumbai.maticvigil.com"
                    },
                    qrcodeModalOptions: {
                        mobileLinks: [
                            "rainbow",
                            "metamask",
                            "argent",
                            "trust",
                            "imtoken",
                            "pillar",
                        ],
                    },
                });

                // Show QR code in modal
                wcProvider.connector.on("display_uri", (err, payload) => {
                    const uri = payload.params[0];
                    document.getElementById('qrSection').style.display = 'block';
                    QRCode.toCanvas(
                        document.getElementById('qrcode'),
                        uri,
                        { width: 250 },
                        function (error) {
                            if (error) console.error(error);
                        }
                    );
                });

                await wcProvider.enable();
                closeWalletModal();
                
                provider = new ethers.BrowserProvider(wcProvider);
                signer = await provider.getSigner();
                userAddress = await signer.getAddress();

                // Event listeners
                wcProvider.on("accountsChanged", (accounts) => {
                    if (accounts.length === 0) disconnectWallet();
                    else location.reload();
                });

                wcProvider.on("chainChanged", () => location.reload());
                wcProvider.on("disconnect", () => disconnectWallet());

                await updateWalletInfo();
                showStatus('کیف پول با موفقیت متصل شد!', 'success');

            } catch (error) {
                closeWalletModal();
                showStatus('خطا در اتصال: ' + error.message, 'error');
            }
        }

        async function updateWalletInfo() {
            const network = await provider.getNetwork();
            
            document.getElementById('walletAddress').textContent = 
                userAddress.slice(0, 6) + '...' + userAddress.slice(-4);
            document.getElementById('networkName').textContent = 
                getNetworkName(network.chainId) + ' (Chain ID: ' + network.chainId + ')';
            document.getElementById('walletInfo').style.display = 'block';
            document.getElementById('connectBtn').style.display = 'none';
            document.getElementById('tokenForm').style.display = 'block';
        }

        function disconnectWallet() {
            if (wcProvider) {
                wcProvider.disconnect();
            }
            location.reload();
        }

        function handleAccountsChanged(accounts) {
            if (accounts.length === 0) {
                disconnectWallet();
            } else {
                location.reload();
            }
        }

        function getNetworkName(chainId) {
            const networks = {
                1: 'Ethereum Mainnet',
                5: 'Goerli Testnet',
                11155111: 'Sepolia Testnet',
                56: 'BSC Mainnet',
                97: 'BSC Testnet',
                137: 'Polygon Mainnet',
                80001: 'Mumbai Testnet',
                43114: 'Avalanche',
                42161: 'Arbitrum',
                10: 'Optimism'
            };
            return networks[Number(chainId)] || 'Unknown Network';
        }

        document.getElementById('tokenForm').onsubmit = async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('tokenName').value.trim();
            const symbol = document.getElementById('tokenSymbol').value.trim().toUpperCase();
            const supply = document.getElementById('totalSupply').value;
            
            if (!name || !symbol || !supply) {
                showStatus('لطفاً تمام فیلدها را پر کنید', 'error');
                return;
            }

            const deployBtn = document.getElementById('deployBtn');
            deployBtn.disabled = true;
            deployBtn.innerHTML = 'در حال چاپ... <span class="loading"></span>';
            
            try {
                showStatus('در حال آماده‌سازی قرارداد هوشمند...', 'info');
                
                // Simple ERC20 Token Contract
                const abi = [
                    "constructor(string memory name_, string memory symbol_, uint256 totalSupply_)",
                    "function name() public view returns (string memory)",
                    "function symbol() public view returns (string memory)",
                    "function decimals() public pure returns (uint8)",
                    "function totalSupply() public view returns (uint256)",
                    "function balanceOf(address account) public view returns (uint256)",
                    "function transfer(address to, uint256 amount) public returns (bool)",
                    "function allowance(address owner, address spender) public view returns (uint256)",
                    "function approve(address spender, uint256 amount) public returns (bool)",
                    "function transferFrom(address from, address to, uint256 amount) public returns (bool)"
                ];

                // Complete and correct bytecode for ERC20 token
                const bytecode = "0x60806040523480156200001157600080fd5b5060405162000d2038038062000d20833981810160405281019062000037919062000352565b82600390816200004891906200060e565b5081600490816200005a91906200060e565b508060001b600581905550600554600260006200007c620000e360201b60201c565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550620000ca620000e360201b60201c565b73ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef6005546040516200012b919062000706565b60405180910390a350505062000723565b600033905090565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b620001548262000109565b810181811067ffffffffffffffff821117156200017657620001756200011a565b5b80604052505050565b60006200018b620000eb565b905062000199828262000149565b919050565b600067ffffffffffffffff821115620001bc57620001bb6200011a565b5b620001c78262000109565b9050602081019050919050565b60005b83811015620001f4578082015181840152602081019050620001d7565b60008484015250505050565b60006200021762000211846200019e565b6200017f565b90508281526020810184848401111562000236576200023562000104565b5b62000243848285620001d4565b509392505050565b600082601f830112620002635762000262620000ff565b5b81516200027584826020860162000200565b91505092915050565b6000819050919050565b62000293816200027e565b81146200029f57600080fd5b50565b600081519050620002b38162000288565b92915050565b600080600060608486031215620002d557620002d4620000f5565b5b600084015167ffffffffffffffff811115620002f657620002f5620000fa565b5b620003048682870162000b565b935050602084015167ffffffffffffffff811115620003285762000327620000fa565b5b620003368682870162000b565b92505060406200034986828701620002a2565b9150509250925092565b6000806000606084860312156200036f576200036e620000f5565b5b600084015167ffffffffffffffff81111562000390576200038f620000fa565b5b6200039e868287016200024b565b935050602084015167ffffffffffffffff811115620003c257620003c1620000fa565b5b620003d0868287016200024b565b9250506040620003e386828701620002a2565b9150509250925092565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806200044057607f821691505b602082108103620004565762000455620003f8565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b600060088302620004c07fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8262000481565b620004cc868362000481565b95508019841693508086168417925050509392505050565b6000819050919050565b60006200050f620005096200050384620002e565b620004e4565b620002e565b9050919050565b6000819050919050565b6200052b83620004ee565b620005436200053a8262000516565b8484546200048e565b825550505050565b600090565b6200055a6200054b565b6200056781848462000520565b505050565b5b818110156200058f5762000583600082620055050565b6001810190506200056d565b5050565b601f821115620005de57620005a8816200045c565b620005b38462000471565b81016020851015620005c3578190505b620005db620005d28562000471565b8301826200056c565b50505b505050565b600082821c905092915050565b60006200060360001984600802620005e3565b1980831691505092915050565b60006200061e8383620005f0565b9150826002028217905092915050565b6200063982620003ed565b67ffffffffffffffff8111156200065557620006546200011a565b5b62000661825462000427565b6200066e82828562000593565b600060209050601f831160018114620006a6576000841562000691578287015190505b6200069d858262000610565b8655506200070d565b601f198416620006b6866200045c565b60005b82811015620006e057848901518255600182019150602085019450602081019050620006b9565b86831015620006fd5784890151620006f9601f891682620005f0565b8355505b6001600288020188555050505b505050505050565b6200072081620002e565b82525050565b60006020820190506200073d600083018462000715565b92915050565b6105ed80620007536000396000f3fe608060405234801561001057600080fd5b50600436106100a95760003560e01c80633950935111610071578063395093511461016857806370a082311461019857806395d89b41146101c8578063a457c2d7146101e6578063a9059cbb14610216578063dd62ed3e14610246576100a9565b806306fdde03146100ae578063095ea7b3146100cc57806318160ddd146100fc57806323b872dd1461011a578063313ce5671461014a575b600080fd5b6100b6610276565b6040516100c391906103f2565b60405180910390f35b6100e660048036038101906100e191906104ad565b610308565b6040516100f39190610508565b60405180910390f35b61010461032b565b6040516101119190610532565b60405180910390f35b610134600480360381019061012f919061054d565b610335565b6040516101419190610508565b60405180910390f35b610152610364565b60405161015f91906105bc565b60405180910390f35b610182600480360381019061017d91906104ad565b61036d565b60405161018f9190610508565b60405180910390f35b6101b260048036038101906101ad91906105d7565b6103a4565b6040516101bf9190610532565b60405180910390f35b6101d06103ed565b6040516101dd91906103f2565b60405180910390f35b61020060048036038101906101fb91906104ad565b61047f565b60405161020d9190610508565b60405180910390f35b610230600480360381019061022b91906104ad565b6104f6565b60405161023d9190610508565b60405180910390f35b610260600480360381019061025b9190610604565b610519565b60405161026d9190610532565b60405180910390f35b60606003805461028590610673565b80601f01602080910402602001604051908101604052809291908181526020018280546102b190610673565b80156102fe5780601f106102d3576101008083540402835291602001916102fe565b820191906000526020600020905b8154815290600101906020018083116102e157829003601f168201915b5050505050905090565b6000806103136105a0565b90506103208185856105a8565b600191505092915050565b6000600554905090565b6000806103406105a0565b905061034d858285610771565b6103588585856107fd565b60019150509392505050565b60006012905090565b6000806103786105a0565b905061039981858561038a8589610519565b61039491906106d3565b6105a8565b600191505092915050565b6000600260008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b6060600480546103fc90610673565b80601f016020809104026020016040519081016040528092919081815260200182805461042890610673565b80156104755780601f1061044a57610100808354040283529160200191610475565b820191906000526020600020905b81548152906001019060200180831161045857829003601f168201915b5050505050905090565b60008061048a6105a0565b905060006104988286610519565b9050838110156104dd576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104d490610779565b60405180910390fd5b6104ea82868684036105a8565b60019250505092915050565b6000806105016105a0565b905061050e8185856107fd565b600191505092915050565b6000600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600033905090565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610617576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161060e9061080b565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610686576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161067d9061089d565b60405180910390fd5b80600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9258360405161076491906104532565b60405180910390a3505050565b600061077d8484610519565b90507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff81146107f757818110156107e9576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107e090610909565b60405180910390fd5b6107f684848484036105a8565b5b50505050565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff160361086c576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108639061099b565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036108db576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108d290610a2d565b60405180910390fd5b6108e6838383610a95565b6000600260008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490508181101561096d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161096490610abf565b60405180910390fd5b818103600260008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555081600260008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef84604051610a5b9190610532565b60405180910390a3610a6e848484610a9a565b50505050565b600081519050919050565b600082825260208201905092915050565b60005b83811015610aae578082015181840152602081019050610a93565b60008484015250505050565b6000601f19601f8301169050919050565b6000610ad682610a74565b610ae08185610a7f565b9350610af0818560208601610a90565b610af981610aba565b840191505092915050565b60006020820190508181036000830152610b1e8184610acb565b905092915050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000610b5682610b2b565b9050919050565b610b6681610b4b565b8114610b7157600080fd5b50565b600081359050610b8381610b5d565b92915050565b6000819050919050565b610b9c81610b89565b8114610ba757600080fd5b50565b600081359050610bb981610b93565b92915050565b60008060408385031215610bd657610bd5610b26565b5b6000610be485828601610b74565b9250506020610bf585828601610baa565b9150509250929050565b60008115159050919050565b610c1481610bff565b82525050565b6000602082019050610c2f6000830184610c0b565b92915050565b610c3e81610b89565b82525050565b6000602082019050610c596000830184610c35565b92915050565b600080600060608486031215610c7857610c77610b26565b5b6000610c8686828701610b74565b9350506020610c9786828701610b74565b9250506040610ca886828701610baa565b9150509250925092565b600060ff82169050919050565b610cc881610cb2565b82525050565b6000602082019050610ce36000830184610cbf565b92915050565b600060208284031215610cff57610cfe610b26565b5b6000610d0d84828501610b74565b91505092915050565b60008060408385031215610d2d57610d2c610b26565b5b6000610d3b85828601610b74565b9250506020610d4c85828601610b74565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680610d9d57607f821691505b602082108103610db057610daf610d56565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000610df082610b89565b9150610dfb83610b89565b9250828201905080821115610e1357610e12610db6565b5b92915050565b7f45524332303a2064656372656173656420616c6c6f77616e63652062656c6f7760008201527f207a65726f000000000000000000000000000000000000000000000000000000602082015250565b6000610e75602583610a7f565b9150610e8082610e19565b604082019050919050565b60006020820190508181036000830152610ea481610e68565b9050919050565b7f45524332303a20617070726f76652066726f6d20746865207a65726f2061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b6000610f07602483610a7f565b9150610f1282610eab565b604082019050919050565b60006020820190508181036000830152610f3681610efa565b9050919050565b7f45524332303a20617070726f766520746f20746865207a65726f20616464726560008201527f7373000000000000000000000000000000000000000000000000000000000000602082015250565b6000610f99602283610a7f565b9150610fa482610f3d565b604082019050919050565b60006020820190508181036000830152610fc881610f8c565b9050919050565b7f45524332303a20696e73756666696369656e7420616c6c6f77616e6365000000600082015250565b6000611005601d83610a7f565b915061101082610fcf565b602082019050919050565b6000602082019050818103600083015261103481610ff8565b9050919050565b7f45524332303a207472616e736665722066726f6d20746865207a65726f20616460008201527f6472657373000000000000000000000000000000000000000000000000000000602082015250565b6000611097602583610a7f565b91506110a28261103b565b604082019050919050565b600060208201905081810360008301526110c68161108a565b9050919050565b7f45524332303a207472616e7366657220746f20746865207a65726f206164647260008201527f6573730000000000000000000000000000000000000000000000000000000000602082015250565b6000611129602383610a7f565b9150611134826110cd565b604082019050919050565b600060208201905081810360008301526111588161111c565b9050919050565b7f45524332303a207472616e7366657220616d6f756e742065786365656473206260008201527f616c616e63650000000000000000000000000000000000000000000000000000602082015250565b60006111bb602683610a7f565b91506111c68261115f565b604082019050919050565b600060208201905081810360008301526111ea816111ae565b905091905056fea2646970667358221220";

                showStatus('در حال ارسال تراکنش به شبکه...', 'info');
                
                // Deploy contract
                const totalSupplyWithDecimals = ethers.parseUnits(supply, 18);
                
                const factory = new ethers.ContractFactory(abi, bytecode, signer);
                const contract = await factory.deploy(name, symbol, totalSupplyWithDecimals, {
                    gasLimit: 3000000
                });
                
                showStatus('در انتظار تایید تراکنش (لطفاً صبر کنید...)...', 'info');
                const receipt = await contract.deploymentTransaction().wait();
                
                const contractAddress = await contract.getAddress();
                const network = await provider.getNetwork();
                
                const explorerUrl = getExplorerUrl(network.chainId, contractAddress);
                
                let statusHtml = `<strong>✅ توکن با موفقیت چاپ شد!</strong><br><br>`;
                statusHtml += `<strong>نام:</strong> ${name}<br>`;
                statusHtml += `<strong>سیمبل:</strong> ${symbol}<br>`;
                statusHtml += `<strong>تعداد کل:</strong> ${supply} (با 18 decimal)<br>`;
                statusHtml += `<div class="contract-info">`;
                statusHtml += `<strong>آدرس قرارداد:</strong><br>`;
                statusHtml += `<code>${contractAddress}</code><br><br>`;
                if (explorerUrl) {
                    statusHtml += `<a href="${explorerUrl}" target="_blank">🔍 مشاهده در Block Explorer</a>`;
                }
                statusHtml += `</div>`;
                statusHtml += `<br><small>💡 نکته: این توکن الان در کیف پول شما قرار دارد و می‌توانید آن را transfer کنید!</small>`;
                
                showStatus(statusHtml, 'success');
                
                deployBtn.disabled = false;
                deployBtn.innerHTML = 'چاپ توکن دیگر';
                
            } catch (error) {
                console.error('Deploy Error:', error);
                
                let errorMsg = 'خطای ناشناخته';
                
                if (error.code === 'ACTION_REJECTED' || error.code === 4001) {
                    errorMsg = 'تراکنش توسط کاربر رد شد';
                } else if (error.message && error.message.includes('insufficient funds')) {
                    errorMsg = 'موجودی کافی برای پرداخت Gas Fee ندارید. لطفاً کیف پول خود را شارژ کنید.';
                } else if (error.message) {
                    errorMsg = error.message;
                }
                
                showStatus('❌ خطا در چاپ توکن: ' + errorMsg, 'error');
                deployBtn.disabled = false;
                deployBtn.innerHTML = 'چاپ توکن';
            }
        };

        function getExplorerUrl(chainId, address) {
            const explorers = {
                1: 'https://etherscan.io/address/',
                5: 'https://goerli.etherscan.io/address/',
                11155111: 'https://sepolia.etherscan.io/address/',
                56: 'https://bscscan.com/address/',
                97: 'https://testnet.bscscan.com/address/',
                137: 'https://polygonscan.com/address/',
                80001: 'https://mumbai.polygonscan.com/address/',
                43114: 'https://snowtrace.io/address/',
                42161: 'https://arbiscan.io/address/',
                10: 'https://optimistic.etherscan.io/address/'
            };
            const baseUrl = explorers[Number(chainId)];
            return baseUrl ? baseUrl + address : '';
        }
        
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.innerHTML = message;
            status.className = 'status ' + type;
            status.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Close modal when clicking outside
        document.getElementById('walletModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeWalletModal();
            }
        });
    </script>
</body>
</html>
